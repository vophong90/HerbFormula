<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Há»— trá»£ láº­p phÆ°Æ¡ng YHCT</title>

  <!-- UI libs -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js + annotation -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
  <script>Chart.register(window['chartjs-plugin-annotation']);</script>

  <!-- i18n strings -->
  <script src="js/lang/lang_vi.js"></script>
  <script src="js/lang/lang_zh.js"></script>

  <!-- Náº¡p Ä‘á»™ng dá»¯ liá»‡u theo ngÃ´n ngá»¯ -->
  <script>
    // Cáº¥u hÃ¬nh Ä‘Æ°á»ng dáº«n dá»¯ liá»‡u cho tá»«ng ngÃ´n ngá»¯
    const DATA_FILES = {
      vi: [
        "./js/data/herbal_list.vi.js",
        "./js/data/doi_duoc_data.vi.js",
        "./js/data/strengherb.vi.js",
      ],
      zh: [
        "./js/data/herbal_list.zh.js",
        "./js/data/doi_duoc_data.zh.js",
        "./js/data/strengherb.zh.js",
      ],
    };

    // NgÃ´n ngá»¯ Ä‘ang dÃ¹ng
    window.langCode = "vi";

    // XoÃ¡ biáº¿n dá»¯ liá»‡u toÃ n cá»¥c náº¿u cÃ³ (trÃ¡nh trá»™n khi Ä‘á»•i ngÃ´n ngá»¯)
    function unloadDataGlobals() {
      try {
        delete window.herbalList;
        delete window.doiDuocData;
        delete window.strengHerb;
      } catch(e) {
        window.herbalList = null;
        window.doiDuocData = null;
        window.strengHerb = null;
      }
    }

    // Náº¡p tuáº§n tá»± cÃ¡c file dá»¯ liá»‡u theo ngÃ´n ngá»¯
    function loadDataForLang(lang) {
      if (!DATA_FILES[lang]) {
        console.warn("Thiáº¿u cáº¥u hÃ¬nh dá»¯ liá»‡u cho ngÃ´n ngá»¯:", lang);
        return Promise.resolve();
      }
      // Gá»¡ cÃ¡c script dá»¯ liá»‡u cÅ© náº¿u cÃ³
      document.querySelectorAll('script[data-i18n-data="1"]').forEach(s => s.remove());
      unloadDataGlobals();

      // ChÃ¨n script theo thá»© tá»± Ä‘á»ƒ Ä‘áº£m báº£o phá»¥ thuá»™c
      return DATA_FILES[lang].reduce((p, src) => {
        return p.then(() => new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = src;
          s.async = false;
          s.defer = false;
          s.dataset.i18nData = "1";
          s.onload = resolve;
          s.onerror = () => reject(new Error("KhÃ´ng táº£i Ä‘Æ°á»£c: " + src));
          document.head.appendChild(s);
        }));
      }, Promise.resolve()).then(() => {
        window.langCode = lang;
        // ThÃ´ng bÃ¡o cho app (main.js) biáº¿t dá»¯ liá»‡u Ä‘Ã£ sáºµn sÃ ng
        window.dispatchEvent(new CustomEvent("i18n-data-loaded", { detail: { lang } }));
      });
    }

    // Náº¡p dá»¯ liá»‡u ban Ä‘áº§u (VI) trÆ°á»›c khi main.js cháº¡y
    window._initialDataPromise = loadDataForLang(window.langCode);
  </script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

  <!-- Chá»n ngÃ´n ngá»¯ -->
  <div class="fixed top-4 right-6 z-50">
    <select id="lang-select" class="border rounded px-2 py-1 shadow bg-white">
      <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
      <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
    </select>
  </div>

  <div class="flex-grow">
    <div class="max-w-5xl mx-auto px-4 py-6 w-full">
      <h1 id="main-app-title" class="text-3xl font-bold text-center mb-6">
        ğŸ§¾ á»¨ng dá»¥ng há»— trá»£ láº­p phÆ°Æ¡ng Y há»c cá»• truyá»n
      </h1>

      <!-- Tabs Ä‘iá»u hÆ°á»›ng -->
      <div class="w-full flex justify-center px-4 py-4">
        <nav class="flex bg-white rounded-2xl shadow-inner border border-gray-200 overflow-x-auto" id="main-step-tabs">
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step0"><span class="mr-1">ğŸ“‚</span>B0: Há»“ sÆ¡</button>
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step1"><span class="mr-1">ğŸ©º</span>B1: LÃ¢m sÃ ng</button>
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step2"><span class="mr-1">ğŸ“Š</span>B2: ÄÃ¡nh giÃ¡</button>
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step3"><span class="mr-1">ğŸ“–</span>B3: Biá»‡n chá»©ng</button>
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step4"><span class="mr-1">ğŸ’¡</span>B4: Gá»£i Ã½ toa</button>
          <button class="step-tab px-5 py-2 font-medium text-gray-600 hover:text-blue-700 hover:bg-blue-100 transition-all duration-200 focus:outline-none rounded-2xl"
            data-path="#/step5"><span class="mr-1">ğŸ› ï¸</span>B5: Hiá»‡u chá»‰nh</button>
        </nav>
      </div>

      <!-- NÆ¡i render ná»™i dung tá»«ng bÆ°á»›c -->
      <div id="app"></div>
    </div>
  </div>

  <!-- Khá»Ÿi Ä‘á»™ng app (nÃªn await _initialDataPromise trong main.js trÆ°á»›c khi render) -->
  <script type="module" src="./js/main.js"></script>

  <footer class="mt-16 border-t bg-gray-100 text-center text-sm text-gray-600 py-6 shadow-inner">
    ğŸ‘¨â€ğŸ’» Thiáº¿t káº¿ bá»Ÿi <strong>VÃµ Thanh Phong</strong> vá»›i sá»± há»— trá»£ cá»§a <strong>ChatGPT</strong>.<br>
    Â© <span id="currentYear"></span> Báº£n quyá»n thuá»™c vá» <strong>VÃµ Thanh Phong</strong>.
  </footer>

  <!-- NÄƒm hiá»‡n táº¡i -->
  <script>
    document.getElementById("currentYear").textContent = new Date().getFullYear();
  </script>

  <!-- Äá»•i ngÃ´n ngá»¯ cho tiÃªu Ä‘á» app, tabs + náº¡p láº¡i dá»¯ liá»‡u -->
  <script>
    function updateAppNavLang() {
      if (window.lang && window.lang.app_title)
        document.getElementById('main-app-title').textContent = window.lang.app_title;

      const stepTabs = document.querySelectorAll('.step-tab');
      if (window.lang && window.lang.step_tab && stepTabs.length === window.lang.step_tab.length) {
        stepTabs.forEach((btn, i) => {
          const icon = btn.querySelector('span')?.outerHTML || '';
          btn.innerHTML = icon + window.lang.step_tab[i];
        });
      }
    }

    // Láº¯ng nghe chá»n ngÃ´n ngá»¯
    document.getElementById('lang-select').addEventListener('change', function() {
      const newLang = (this.value === 'zh') ? 'zh' : 'vi';
      window.lang = (newLang === 'zh') ? window.lang_zh : window.lang_vi;
      updateAppNavLang();

      // Náº¡p láº¡i dá»¯ liá»‡u tÆ°Æ¡ng á»©ng ngÃ´n ngá»¯ rá»“i render láº¡i
      loadDataForLang(newLang)
        .then(() => {
          // Náº¿u main.js cÃ³ hÃ m re-render riÃªng, cÃ³ thá»ƒ gá»i: window.app?.rerender?.();
          // Máº·c Ä‘á»‹nh dÃ¹ng hashchange Ä‘á»ƒ buá»™c render láº¡i theo route hiá»‡n táº¡i
          window.dispatchEvent(new Event("hashchange"));
        })
        .catch(err => {
          alert("Lá»—i náº¡p dá»¯ liá»‡u cho ngÃ´n ngá»¯ má»›i: " + err.message);
          console.error(err);
        });
    });

    // Khá»Ÿi táº¡o láº§n Ä‘áº§u (VI)
    window.lang = window.lang_vi;
    updateAppNavLang();
  </script>
</body>
</html>

