<!-- partials/step4.html -->
<div id="step-4" class="step-section">
  <h2 class="text-2xl font-semibold mb-4">ğŸ§ª BÆ°á»›c 4: Gá»£i Ã½ bÃ i thuá»‘c theo mÃ´ hÃ¬nh 6S</h2>

  <!-- 1. Há»™i chá»©ng YHCT -->
  <div class="mb-6">
    <label class="font-semibold block mb-1">ğŸ“Œ Há»™i chá»©ng Y há»c cá»• truyá»n:</label>
    <div id="confirmed-syndrome" class="bg-gray-100 border px-4 py-2 rounded text-gray-800"></div>
  </div>

  <div class="mb-6">
    <label class="font-semibold block mb-1">ğŸ” CÃ¡c triá»‡u chá»©ng ná»•i báº­t (VAS cao):</label>
    <ul id="step4-top-symptom-list" class="list-disc list-inside text-gray-700"></ul>
  </div>
  
  <!-- 2. PhÃ¡p trá»‹ vÃ  Tra cá»©u Ä‘á»‘i dÆ°á»£c -->
  <div class="mb-6 border-t pt-6">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- GPT gá»£i Ã½ phÃ¡p trá»‹ -->
      <div class="flex-1 flex flex-col">
        <button onclick="autoSuggestMethod()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-3 w-full">
          âš™ï¸ GPT gá»£i Ã½ phÃ¡p trá»‹
        </button>
        <textarea id="treatmethod-gpt" rows="6"
          class="w-full border rounded px-3 py-2 bg-gray-100 text-gray-800 flex-grow"
          placeholder="GPT sáº½ hiá»ƒn thá»‹ phÃ¡p trá»‹ phÃ¹ há»£p cho bá»‡nh nhÃ¢n táº¡i Ä‘Ã¢y..." readonly></textarea>
      </div>
      <!-- Tra cá»©u Ä‘á»‘i dÆ°á»£c -->
      <div class="flex-1 flex flex-col">
        <label for="keyword-doiduoc" class="block font-semibold mb-1">ğŸ” Nháº­p tá»« khÃ³a Ä‘á»ƒ tra cá»©u Ä‘á»‘i dÆ°á»£c:</label>
        <div class="flex space-x-2 mb-3">
          <input type="text" id="keyword-doiduoc" class="flex-grow border rounded px-3 py-2"
            placeholder="VÃ­ dá»¥: Äau lÆ°ng, ThoÃ¡i hÃ³a khá»›p...">
          <button onclick="searchDoiDuocByKeyword()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            ğŸ” Tra cá»©u
          </button>
        </div>
        <label for="result-doiduoc" class="block font-semibold mb-1">ğŸ“‹ Káº¿t quáº£ tra cá»©u:</label>
        <textarea id="result-doiduoc" rows="6"
          class="w-full border rounded px-3 py-2 bg-gray-100 text-gray-800 flex-grow"
          placeholder="Káº¿t quáº£ sáº½ hiá»ƒn thá»‹ táº¡i Ä‘Ã¢y..." readonly></textarea>
      </div>
    </div>
  </div>

  <!-- 3. MÃ´ táº£ má»©c Ä‘á»™ vá»‹ thuá»‘c -->
  <div class="mt-8 flex flex-col items-center">
    <label for="effectSelector" class="font-semibold mb-2 text-center">
      ğŸ§ª Chá»n phÃ¡p trá»‹ Ä‘á»ƒ xem biá»ƒu Ä‘á»“ vá»‹ thuá»‘c:
    </label>
    <select id="effectSelector" class="border rounded px-2 py-1 mb-4"></select>
    <div id="herbChartWrapper" class="w-full overflow-x-auto">
      <div class="flex justify-center min-w-fit">
        <canvas id="herbBarChart" height="300"></canvas>
      </div>
    </div>
  </div>

  <!-- 4. CÃ¡c Ã´ nháº­p liá»‡u 6S -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="font-semibold">S1 â€“ Source:</label>
      <textarea id="sixs-source" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="CÃ¡c vá»‹ thuá»‘c Ä‘iá»u trá»‹ trá»±c tiáº¿p vÃ o tÃ¡c nhÃ¢n gÃ¢y bá»‡nh ..."></textarea>
    </div>
    <div>
      <label class="font-semibold">S2 â€“ Symptom:</label>
      <textarea id="sixs-symptom" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="CÃ¡c vá»‹ thuá»‘c Ä‘iá»u trá»‹ triá»‡u chá»©ng than phiá»n chÃ­nh ..."></textarea>
    </div>
    <div>
      <label class="font-semibold">S3 â€“ Site:</label>
      <textarea id="sixs-site" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="CÃ¡c vá»‹ thuá»‘c cÃ³ vá»‹ trÃ­ tÃ¡c Ä‘á»™ng Ä‘áº·c hiá»‡u ..."></textarea>
    </div>
    <div>
      <label class="font-semibold">S4 â€“ Strength:</label>
      <textarea id="sixs-strength" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="Chá»n vá»‹ thuá»‘c cÃ³ hiá»‡u lá»±c tÆ°Æ¡ng á»©ng ..."></textarea>
    </div>
    <div>
      <label class="font-semibold">S5 â€“ Side-effect:</label>
      <textarea id="sixs-sideeffect" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="CÃ¡c vá»‹ thuá»‘c lÃ m giáº£m/máº¥t tÃ¡c dá»¥ng phá»¥ ..."></textarea>
    </div>
    <div>
      <label class="font-semibold">S6 â€“ Secondary Prevention:</label>
      <textarea id="sixs-secondary" rows="2" class="w-full border rounded px-3 py-2 mt-1"
        placeholder="CÃ¡c vá»‹ thuá»‘c cáº¯t Ä‘á»©t con Ä‘Æ°á»ng diá»…n tiáº¿n tiáº¿p theo ..."></textarea>
    </div>
  </div>

  <!-- 5. Toa tá»•ng há»£p -->
  <div class="mb-6 border-t pt-6 mt-6">
    <div class="mb-4">
      <button onclick="renderFinalGPTFormula()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mb-2">
        ğŸ¤– Tá»•ng há»£p vÃ  loáº¡i trÃ¹ng
      </button>
      <textarea id="final-gpt-formula" rows="3" class="w-full border rounded px-3 py-2 bg-gray-100 text-gray-800"
                readonly placeholder="Toa thuá»‘c tá»•ng há»£p tá»« mÃ´ hÃ¬nh GPT..."></textarea>
    </div>
    <div class="mb-4">
      <label class="font-semibold block mb-1">ğŸ‘¨â€âš•ï¸ BÃ¡c sÄ© chá»‰nh sá»­a:</label>
      <textarea id="final-doctor-formula" rows="3" class="w-full border rounded px-3 py-2"
                placeholder="BÃ¡c sÄ© hiá»‡u chá»‰nh láº¡i toa thuá»‘c cuá»‘i cÃ¹ng..."></textarea>
    </div>
  </div>

  <!-- Äiá»u hÆ°á»›ng -->
  <div class="flex justify-between">
    <button onclick="goToStep(3)" class="bg-gray-500 text-white px-4 py-2 rounded">â¬… Quay láº¡i</button>
    <button onclick="saveStep4(); goToStep(5)" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Tiáº¿p tá»¥c â¡</button>
  </div>
</div>
